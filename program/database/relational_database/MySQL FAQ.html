<!DOCTYPE html>

<html lang="en">

        <head>
                <!-- Page information -->
                <meta charset="UTF-8" />
                <meta name="node_id" content="mysql faq">
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link rel="shortcut icon" href="/favicon.ico" />

                <!-- Set title -->
                <title>晓灰-初早天空刚从混沌中醒来</title>

                <!-- Includes -->
                <script src="/obs.html/static/obsidian_core.js"></script>
<script src="/obs.html/static/encoding.js"></script>
<link rel="stylesheet" href="/obs.html/static/master.css" />
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
            'securityLevel': 'loose',
            'theme': 'dark',
            'themeVariables': {
                    'darkMode': true,
            }
    });
</script>
<script>
  MathJax = {
    loader: {
      load: [
        '[tex]/action',
        'output/chtml',
        '[tex]/centernot'
      ]
    },
    tex: {
      inlineMath: [ ["\\(","\\)"] ],
      displayMath: [ ["\\[","\\]"] ],
      processEscapes: true,
      processEnvironments: true,
      packages: {'[+]': ['centernot']}
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script src="/obs.html/static/flexsearch.bundle.js"></script>
<script src="/obs.html/static/pako.js"></script>
<script src="/obs.html/static/search.js"></script>
<script src="/obs.html/static/dirtree.js"></script>




                <!-- Onload tweaks -->
                <script>
                        const CURRENT_NODE = 'mysql faq';
                        const HTML_URL_PREFIX = '';
                        const PAGE_DEPTH = 3;
                </script>
        </head>

<body class="theme-obs-light">
        <div id="antiflash" style="display: none;"></div>
        <script>
                document.getElementById('antiflash').style.display = 'block';
        </script>
        <div id="search-master-div">
    <div id="search-slab" king_ramses="return the slaaab">
            <div id="search-controls">
                    <input id="search_string" placeholder="Type to search notes" type="text" />
                    <div class="tooltip" style="display: none;">
                        <input type="checkbox" id="hard_search" name="hard" />
                        <span class="tooltiptext">Hard search (require exact match)</span>
                    </div>
                    <div id="search-results-box">
                        <div id="search-results"></div>
                    </div>
                    <div id="search-instructions">
                        <div class="prompt-instruction mobile">
                            <button onclick="toggle_id('search-master-div');"><b>Close</b> Search </button>
                        </div>
                    </div>
            </div>
    </div>
</div>

<script>
    document.getElementById("search-master-div").addEventListener('click', e => {
            if(e.target !== e.currentTarget){
                    return
            }
            toggle_id('search-master-div');
    })
    document.getElementById("search_string").addEventListener("input", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    }); 
    document.getElementById("hard_search").addEventListener("click", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    });

    window.addEventListener('keydown', e => {
        if((e.key=='Escape'||e.key=='Esc'||e.keyCode==27)){
            toggle_id('search-master-div');
            return false;
        } 
    }, true);

    function click_list_link(element){
        element.parentElement.getElementsByTagName('a')[0].click()
    }
</script>

        <div id="page_holder" class="flex_col">
                <div id="header" class="header">
    <div id="header_flex" class="flex_row">
            <a href="/index.html" id="homelink" title="Clear screen and go to homepage">晓灰-初早天空刚从混沌中醒来</a>
            <div id="menu_toggle_button" class="navbar-button requires_js" onclick="toggle_menu()">
                    ≡
            </div>
            <div id="navbar" class="navbar requires_js">
                    <a class="navbar-link" href="/index.html" title="Home">Home</a>
<a class="navbar-link" href="/CyberFarmer.html" title="About">About</a>
<a class="navbar-link" href="/program/full-stream/Full-Stream.html" title="FULL-STREAM">FULL-STREAM</a>
<a class="navbar-link" href="/program/database/How-to-Choose-the-suitable-Database.html" title="CHOOSE-DB">CHOOSE-DB</a>
                    <div class="icon-tray">
                            <div id="theme-button" class="theme-button requires_js" title="Change theme" onclick="toggle_theme_popup(this)">
    T
</div>
<script>
    function toggle_theme_popup(el){
        // make theme button show that it's active by adding the .active class
        toggle(el);

        // show the theme selector
        toggle_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            toggle(pu);
        }
    }

    function disable_theme_popup(){
        disable_id('theme-button');

        // show the theme selector
        disable_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            disable(pu);
        }
    }
</script>
                                    <div onclick="openSearch()" class="theme-button requires_js">
            <img src = "/obs.html/static/search.svg" alt="Search notes" title="Search notes" style="margin: 4px;"/>
        </div>
        <script>
            function openSearch(){
                // toggle search popup and continue with extra code if it is enabled this time
                if (toggle_id('search-master-div')){
                    // get input field and temporarily disable it
                    let ss = document.getElementById('search_string');
                    ss.value = 'Seach data initializing...';
                    ss.readOnly = true; 

                    // load search data if not yet done so
                    setTimeout(function(){
                        LoadSearchData()

                        // clear input and put focus on it so that we can start typing immediately
                        ss.value = '';
                        ss.readOnly = false; 
                        ss.focus()
                        ss.select()
                    }, 100);
                }
            }
        </script>
                                    <div class="graph_header_div requires_js">
            <a id="graph_link" class="system-link" href="/obs.html/graph/index.html?node=mysql faq" title="Open fullpage Graph">
                    <img class="graph_header_div_svg" src = "/obs.html/static/graph.svg" alt="Open fullpage Graph" style="margin: 2px; width: 17px;"/>
            </a>
        </div>
                                    <div >
            <a id="dirtree_link" class="system-link" href="/obs.html/dir_index.html" title="View directory tree">
                    <img src = "/obs.html/static/dirtree.svg" style="width: 12px; padding: 4px;" alt="Directory tree link"/>
            </a>
        </div>
                            <div>
    <a href="/obs.html/tags/index.html" title="Open tag view">
            <img src = "/obs.html/static/hashtag.svg" alt="RSS Feed link" style="width: 24px; margin-left: -2px; margin-top: -2px;"/>
    </a>
</div>
                            
                    </div>
                    <div style="display: flex; flex-direction:column">
                        <div id="left_pane_toggle_nav" class="left_pane_toggle_nav">Toggle Directory Tree Pane</div>
                        <div id="right_pane_toggle_nav" class="right_pane_toggle_nav">Toggle Table of Contents Pane</div>
                    </div>
            </div>
    </div>
    <div class="popup" id="theme-popup">
    <label for="cars">Theme </label>

    <select name="theme" id="theme" onchange="set_theme(this.value)">
      <option value="obs-light" selected="selected">obsidian-light</option>
      <option value="obs-dark">obsidian-dark</option>
    </select> 
</div>
</div>
                <div class="flex_row">
                        <div id="left_pane" class="left_pane active">
    <div id="left_pane_fold_header" class="left_pane_fold_header fold_header">x</div>
    <div id="left_pane_content" class="left_pane_content">
            <div id="dirtree"><button id="folder-1" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>java</button>
<div id="folder-container-1" class="dir-container requires_js " path="/java">
	<ul class="dir-list">
		<li><div class="file-icon"></div><a class="" href="/java/Java Framework & Dependency.html"  >Java Framework & Dependency</a></li>
	</ul>
</div>
<button id="folder-2" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>learning</button>
<div id="folder-container-2" class="dir-container requires_js " path="/learning">
	<button id="folder-3" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>choice</button>
	<div id="folder-container-3" class="dir-container requires_js " path="/learning/choice">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/learning/choice/How-to-Choose-Note-Software.html"  >How-to-Choose-Note-Software</a></li>
		</ul>
	</div>
	<button id="folder-4" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>reading</button>
	<div id="folder-container-4" class="dir-container requires_js " path="/learning/reading">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/learning/reading/How-to-read-books-better.html"  >How-to-read-books-better</a></li>
			<li><div class="file-icon"></div><a class="" href="/learning/reading/Self-Determination-Theory.html"  >Self-Determination-Theory</a></li>
			<li><div class="file-icon"></div><a class="" href="/learning/reading/The Idea of History.html"  >The Idea of History</a></li>
			<li><div class="file-icon"></div><a class="" href="/learning/reading/The-Formula-The-Universal-Laws-of-Success.html"  >The-Formula-The-Universal-Laws-of-Success</a></li>
		</ul>
	</div>
	<button id="folder-5" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>wisdom</button>
	<div id="folder-container-5" class="dir-container requires_js " path="/learning/wisdom">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/learning/wisdom/Absent-Minded Learning Yields No Gain.html"  >Absent-Minded Learning Yields No Gain</a></li>
		</ul>
	</div>
	<ul class="dir-list">
		<li><div class="file-icon"></div><a class="" href="/learning/Frequently-Used-Prompt.html"  >Frequently-Used-Prompt</a></li>
		<li><div class="file-icon"></div><a class="" href="/learning/Information Diffusion.html"  >Information Diffusion</a></li>
		<li><div class="file-icon"></div><a class="" href="/learning/Information-Handler.html"  >Information-Handler</a></li>
	</ul>
</div>
<button id="folder-6" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>life</button>
<div id="folder-container-6" class="dir-container requires_js " path="/life">
	<button id="folder-7" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>experience</button>
	<div id="folder-container-7" class="dir-container requires_js " path="/life/experience">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/life/experience/Life-Experience.html"  >Life-Experience</a></li>
		</ul>
	</div>
	<button id="folder-8" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>story</button>
	<div id="folder-container-8" class="dir-container requires_js " path="/life/story">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/life/story/A-Love-That-Only-Made-Me-More-Insecure.html"  >A-Love-That-Only-Made-Me-More-Insecure</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/A-man-who-wants-to-save-face.html"  >A-man-who-wants-to-save-face</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/Alcohol Addiction.html"  >Alcohol Addiction</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/Fail-then-Two-year-For-Overseas-Education.html"  >Fail-then-Two-year-For-Overseas-Education</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/I have done my best-to-play-the-bad-hand-well.html"  >I have done my best-to-play-the-bad-hand-well</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/Marriage-Sale.html"  >Marriage-Sale</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/My ex-boyfriend destroys my worldview.html"  >My ex-boyfriend destroys my worldview</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/So-it-went-for-30-years.html"  >So-it-went-for-30-years</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/Step-by-Step-Error-Choice.html"  >Step-by-Step-Error-Choice</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/The construction industry has declined, where lies the new blue ocean.html"  >The construction industry has declined, where lies the new blue ocean</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/The loneliness after breaking up is really scary.html"  >The loneliness after breaking up is really scary</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/Trapped in the cycle of  anxiety-procrastination-depression-anxiety.html"  >Trapped in the cycle of  anxiety-procrastination-depression-anxiety</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/ZhangYiMing.html"  >ZhangYiMing</a></li>
			<li><div class="file-icon"></div><a class="" href="/life/story/resign from a state-owned enterprise job & give up their household registration to pursue self-discovery.html"  >resign from a state-owned enterprise job & give up their household registration to pursue self-discovery</a></li>
		</ul>
	</div>
	<ul class="dir-list">
		<li><div class="file-icon"></div><a class="" href="/life/How-to-choose-your-work.html"  >How-to-choose-your-work</a></li>
		<li><div class="file-icon"></div><a class="" href="/life/The-Era-When-HumansWill-Understand-Each-Other-Will-Eventually-Come.html"  >The-Era-When-HumansWill-Understand-Each-Other-Will-Eventually-Come</a></li>
		<li><div class="file-icon"></div><a class="" href="/life/信息牢笼.html"  >信息牢笼</a></li>
	</ul>
</div>
<button id="folder-9" class="dir-button active" onclick="toggle_dir(this.id)"><div class="file-icon"></div>program</button>
<div id="folder-container-9" class="dir-container requires_js active" path="/program">
	<button id="folder-10" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>architecher</button>
	<div id="folder-container-10" class="dir-container requires_js " path="/program/architecher">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/architecher/Code-or-Design-Pattern.html"  >Code-or-Design-Pattern</a></li>
		</ul>
	</div>
	<button id="folder-11" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>bot</button>
	<div id="folder-container-11" class="dir-container requires_js " path="/program/bot">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/bot/Ding-Ding-Bot.html"  >Ding-Ding-Bot</a></li>
		</ul>
	</div>
	<button id="folder-12" class="dir-button active" onclick="toggle_dir(this.id)"><div class="file-icon"></div>database</button>
	<div id="folder-container-12" class="dir-container requires_js active" path="/program/database">
		<button id="folder-13" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>HTAP</button>
		<div id="folder-container-13" class="dir-container requires_js " path="/program/database/HTAP">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/database/HTAP/Hologres.html"  >Hologres</a></li>
			</ul>
		</div>
		<button id="folder-14" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>kv_memory</button>
		<div id="folder-container-14" class="dir-container requires_js " path="/program/database/kv_memory">
			<button id="folder-15" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>vx_images</button>
			<div id="folder-container-15" class="dir-container requires_js " path="/program/database/kv_memory/vx_images">
				<ul class="dir-list">
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/2125296809846.png"  class="external-link">2125296809846.png</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/2543722787409.png"  class="external-link">2543722787409.png</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/324746178980.jpg"  class="external-link">324746178980.jpg</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/5493237811439.png"  class="external-link">5493237811439.png</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/5920443129073.png"  class="external-link">5920443129073.png</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/aeFd.gif"  class="external-link">aeFd.gif</a></li>
					<li><div class="file-icon non-md-file"></div><a class="" href="/program/database/kv_memory/vx_images/epoll.gif"  class="external-link">epoll.gif</a></li>
				</ul>
			</div>
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/database/kv_memory/Redis源码架构阅读.html"  >Redis源码架构阅读</a></li>
			</ul>
		</div>
		<button id="folder-16" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>olap</button>
		<div id="folder-container-16" class="dir-container requires_js " path="/program/database/olap">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/database/olap/Optimized-Row-Columnar.html"  >Optimized-Row-Columnar</a></li>
			</ul>
		</div>
		<button id="folder-17" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>product</button>
		<div id="folder-container-17" class="dir-container requires_js " path="/program/database/product">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/database/product/Bigtable.html"  >Bigtable</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/database/product/OceanBase.html"  >OceanBase</a></li>
			</ul>
		</div>
		<button id="folder-18" class="dir-button active" onclick="toggle_dir(this.id)"><div class="file-icon"></div>relational_database</button>
		<div id="folder-container-18" class="dir-container requires_js active" path="/program/database/relational_database">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="active current_page_dirtree" href="/program/database/relational_database/MySQL FAQ.html"  >MySQL FAQ</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/database/relational_database/MySQL Index Introduction.html"  >MySQL Index Introduction</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/database/relational_database/Possible Problems with Sharding and Partitioning.html"  >Possible Problems with Sharding and Partitioning</a></li>
			</ul>
		</div>
		<button id="folder-19" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>search</button>
		<div id="folder-container-19" class="dir-container requires_js " path="/program/database/search">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/database/search/Inverted-Index-of-Lucene-and-B-Tree.html"  >Inverted-Index-of-Lucene-and-B-Tree</a></li>
			</ul>
		</div>
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/database/Binlog Master-Slave Data Synchronization.html"  >Binlog Master-Slave Data Synchronization</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Common Metrics of MySQL.html"  >Common Metrics of MySQL</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Database Solutions for Distributed Systems.html"  >Database Solutions for Distributed Systems</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Horizontal Scaling.html"  >Horizontal Scaling</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/How-to-Choose-the-Suitable-Database.html"  >How-to-Choose-the-Suitable-Database</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Prevention and Monitoring of Slow SQL.html"  >Prevention and Monitoring of Slow SQL</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Redo-log Master-Slave Data Synchronization.html"  >Redo-log Master-Slave Data Synchronization</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/SST(Sorted String Table).html"  >SST(Sorted String Table)</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Storage-Compute Architecture.html"  >Storage-Compute Architecture</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/database/Write-Ahead Logging.html"  >Write-Ahead Logging</a></li>
		</ul>
	</div>
	<button id="folder-20" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>full-stream</button>
	<div id="folder-container-20" class="dir-container requires_js " path="/program/full-stream">
		<button id="folder-21" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>Test</button>
		<div id="folder-container-21" class="dir-container requires_js " path="/program/full-stream/Test">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/full-stream/Test/JUnit5 & Mockito.html"  >JUnit5 & Mockito</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/full-stream/Test/Test Need Geek.html"  >Test Need Geek</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/full-stream/Test/Unit Level Test Theory、Tool、Discussion.html"  >Unit Level Test Theory、Tool、Discussion</a></li>
			</ul>
		</div>
		<button id="folder-22" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>seo</button>
		<div id="folder-container-22" class="dir-container requires_js " path="/program/full-stream/seo">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/full-stream/seo/Search Engine Optimization.html"  >Search Engine Optimization</a></li>
			</ul>
		</div>
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/full-stream/Analyzing.html"  >Analyzing</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/full-stream/Code-Oriented-Draw.html"  >Code-Oriented-Draw</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/full-stream/Full-Stream.html"  >Full-Stream</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/full-stream/Modeling.html"  >Modeling</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/full-stream/Prototype-Diagram.html"  >Prototype-Diagram</a></li>
			<li><div class="file-icon non-md-file"></div><a class="" href="/program/full-stream/full-stream.canvas"  class="external-link">full-stream.canvas</a></li>
		</ul>
	</div>
	<button id="folder-23" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>llm</button>
	<div id="folder-container-23" class="dir-container requires_js " path="/program/llm">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/llm/Enhanced-Search-With-AI.excalidraw.html"  >Enhanced-Search-With-AI.excalidraw</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/llm/Vector-Database.html"  >Vector-Database</a></li>
		</ul>
	</div>
	<button id="folder-24" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>networking</button>
	<div id="folder-container-24" class="dir-container requires_js " path="/program/networking">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/networking/RDMA.html"  >RDMA</a></li>
		</ul>
	</div>
	<button id="folder-25" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>operation-system</button>
	<div id="folder-container-25" class="dir-container requires_js " path="/program/operation-system">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/operation-system/PageCache.html"  >PageCache</a></li>
		</ul>
	</div>
	<button id="folder-26" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>practices</button>
	<div id="folder-container-26" class="dir-container requires_js " path="/program/practices">
		<button id="folder-27" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>Distributed System</button>
		<div id="folder-container-27" class="dir-container requires_js " path="/program/practices/Distributed System">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/Distributed System Problems.html"  >Distributed System Problems</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/Master-Slave-Switch.html"  >Master-Slave-Switch</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/Optimize Kinds of Resource Use.html"  >Optimize Kinds of Resource Use</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/Paxos.html"  >Paxos</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/Raft.html"  >Raft</a></li>
				<li><div class="file-icon"></div><a class="" href="/program/practices/Distributed System/缓存带来的各种问题.html"  >缓存带来的各种问题</a></li>
			</ul>
		</div>
		<button id="folder-28" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>Git</button>
		<div id="folder-container-28" class="dir-container requires_js " path="/program/practices/Git">
			<ul class="dir-list">
				<li><div class="file-icon"></div><a class="" href="/program/practices/Git/Frequently Git Command.html"  >Frequently Git Command</a></li>
			</ul>
		</div>
		<ul class="dir-list">
			<li><div class="file-icon non-md-file"></div><a class="" href="/program/practices/Classic Process Data Infrastructure.canvas"  class="external-link">Classic Process Data Infrastructure.canvas</a></li>
			<li><div class="file-icon non-md-file"></div><a class="" href="/program/practices/Finance Technology Area Relation.canvas"  class="external-link">Finance Technology Area Relation.canvas</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/practices/Frequently-IDEA-Shortcut.html"  >Frequently-IDEA-Shortcut</a></li>
			<li><div class="file-icon"></div><a class="" href="/program/practices/Practices-for-Processing-l0-Billion-Bill-data.html"  >Practices-for-Processing-l0-Billion-Bill-data</a></li>
		</ul>
	</div>
	<button id="folder-29" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>technology</button>
	<div id="folder-container-29" class="dir-container requires_js " path="/program/technology">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/program/technology/Distributed Computing.html"  >Distributed Computing</a></li>
		</ul>
	</div>
	<ul class="dir-list">
	</ul>
</div>
<button id="folder-30" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>society</button>
<div id="folder-container-30" class="dir-container requires_js " path="/society">
	<ul class="dir-list">
		<li><div class="file-icon non-md-file"></div><a class="" href="/society/业财一体.canvas"  class="external-link">业财一体.canvas</a></li>
	</ul>
</div>
<button id="folder-31" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>store</button>
<div id="folder-container-31" class="dir-container requires_js " path="/store">
	<button id="folder-32" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>Buffer</button>
	<div id="folder-container-32" class="dir-container requires_js " path="/store/Buffer">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/store/Buffer/Java Fuzz Test.html"  >Java Fuzz Test</a></li>
		</ul>
	</div>
	<button id="folder-33" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>history-program</button>
	<div id="folder-container-33" class="dir-container requires_js " path="/store/history-program">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/store/history-program/Knowledge-Management-System.html"  >Knowledge-Management-System</a></li>
			<li><div class="file-icon"></div><a class="" href="/store/history-program/Servicer-Chat-System.excalidraw.html"  >Servicer-Chat-System.excalidraw</a></li>
			<li><div class="file-icon"></div><a class="" href="/store/history-program/index-insight.excalidraw.html"  >index-insight.excalidraw</a></li>
			<li><div class="file-icon"></div><a class="" href="/store/history-program/淘工厂客服知识库和问答相关的工作.html"  >淘工厂客服知识库和问答相关的工作</a></li>
		</ul>
	</div>
	<button id="folder-34" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>微信公众号</button>
	<div id="folder-container-34" class="dir-container requires_js " path="/store/微信公众号">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/store/微信公众号/假如你五行属商家，如何和淘天做生意？.html"  >假如你五行属商家，如何和淘天做生意？</a></li>
		</ul>
	</div>
	<ul class="dir-list">
	</ul>
</div>
<button id="folder-35" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>story</button>
<div id="folder-container-35" class="dir-container requires_js " path="/story">
	<button id="folder-36" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>history</button>
	<div id="folder-container-36" class="dir-container requires_js " path="/story/history">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/story/history/Alibaba-C2M.html"  >Alibaba-C2M</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/history/Others' Story.html"  >Others' Story</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/history/Xiao-Hong-Shu.html"  >Xiao-Hong-Shu</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/history/mdnice.html"  >mdnice</a></li>
		</ul>
	</div>
	<button id="folder-37" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>observe</button>
	<div id="folder-container-37" class="dir-container requires_js " path="/story/observe">
		<ul class="dir-list">
			<li><div class="file-icon"></div><a class="" href="/story/observe/Customer-Behavior.html"  >Customer-Behavior</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/observe/E-Commerce Business Models.html"  >E-Commerce Business Models</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/observe/High-risk Areas for Young People's Entrepreneurship Failure.html"  >High-risk Areas for Young People's Entrepreneurship Failure</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/observe/Overseas Lack of Chinese Similar Products.html"  >Overseas Lack of Chinese Similar Products</a></li>
			<li><div class="file-icon"></div><a class="" href="/story/observe/Work Involved In Opening an E-Commerce Store.html"  >Work Involved In Opening an E-Commerce Store</a></li>
		</ul>
	</div>
	<ul class="dir-list">
		<li><div class="file-icon"></div><a class="" href="/story/Start-up Resources Collection.html"  >Start-up Resources Collection</a></li>
		<li><div class="file-icon"></div><a class="" href="/story/搜索需求的分流.html"  >搜索需求的分流</a></li>
	</ul>
</div>
<ul class="dir-list">
	<li><div class="file-icon"></div><a class="" href="/A Brand Called xiaohui.html"  >A Brand Called xiaohui</a></li>
	<li><div class="file-icon"></div><a class="" href="/Blog-Technology-Stack.html"  >Blog-Technology-Stack</a></li>
	<li><div class="file-icon"></div><a class="" href="/CyberFarmer.html"  >CyberFarmer</a></li>
	<li><div class="file-icon"></div><a class="" href="/Story.html"  >Story</a></li>
	<li><div class="file-icon"></div><a class="" href="/index.html"  >index</a></li>
	<li><div class="file-icon"></div><a class="" href="/xiaohui-blog-technology-architecture.excalidraw.html"  >xiaohui-blog-technology-architecture.excalidraw</a></li>
</ul>
</div>
    </div>
</div>
                        <div class="container">
                                <div class="content"><h1 id="mysql-faq">MySQL FAQ</h1>
<div class="toc">
<ul>
<li><a href="#mysql-faq" class="anchor-link">MySQL FAQ</a><ul>
<li><a href="#h_1-mysql" class="anchor-link">1. 理解 MySQL 索引</a><ul>
<li><a href="#h_1-1-mysql" class="anchor-link">1.1. MySQL 索引会常驻内存吗?</a></li>
<li><a href="#h_1-2-mysql" class="anchor-link">1.2. MySQL索引怎么被加载到内存的?</a></li>
<li><a href="#h_1-3-mysql" class="anchor-link">1.3. 既然常驻内存,那MySQL索引如何被淘汰?</a></li>
<li><a href="#h_1-4-b" class="anchor-link">1.4. 为什么选择B+树?</a></li>
<li><a href="#h_1-5-b-treelog-structured-merge-tree" class="anchor-link">1.5. B-tree和Log-Structured Merge Tree本质区别是什么？</a></li>
<li><a href="#h_1-6-b" class="anchor-link">1.6. B+树和倒排索引本质区别是什么?</a><ul>
<li><a href="#h_1-6-1-idb" class="anchor-link">1.6.1. 以id列为主键的B+树的聚簇索引</a></li>
<li><a href="#h_1-6-2-address" class="anchor-link">1.6.2. 以address列为索引的二级索引</a></li>
<li><a href="#h_1-6-3-address" class="anchor-link">1.6.3. 为address列建立的倒排索引</a></li>
</ul>
</li>
<li><a href="#h_1-7-b" class="anchor-link" class="anchor-link">1.7. B+树的分叉数是多少?</a></li>
<li><a href="#h_1-8-b-16kb" class="anchor-link">1.8. 为什么B+树的每个结点都是16kb大小?</a></li>
<li><a href="#h_1-9-file-sysytem4kb" class="anchor-link">1.9. 可是File Sysytem的页大小是4kb啊？</a></li>
<li><a href="#h_1-10-b" class="anchor-link">1.10. B+树一页能存多少数据?</a></li>
<li><a href="#h_1-11-b" class="anchor-link">1.11. B+树为什么控制层高?一般控制为多少？</a></li>
<li><a href="#h_1-12-mysql2000w" class="anchor-link">1.12. 为什么都说Mysql单表不要超过2000w条数据?</a></li>
<li><a href="#h_1-13" class="anchor-link">1.13. 以上算了一遍，然后呢？</a></li>
</ul>
</li>
<li><a href="#h_2-sql" class="anchor-link">2.索引优化与慢SQL预防</a><ul>
<li><a href="#h__1" class="anchor-link">如何建立主键索引?</a><ul>
<li><a href="#h__2" class="anchor-link">区分业务主键与数据库主键</a></li>
<li><a href="#trade_no" class="anchor-link">索引可以用已有的唯一键，如trade_no吗？</a></li>
</ul>
</li>
<li><a href="#sql" class="anchor-link">慢SQL 预防与排查</a></li>
<li><a href="#h__3" class="anchor-link">如何优化索引</a><ul>
<li><a href="#h__4" class="anchor-link">索引是最左匹配的</a></li>
<li><a href="#h__5" class="anchor-link">默认的索引下推优化</a></li>
<li><a href="#h__6" class="anchor-link">隐藏索引</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#h_3-mysql" class="anchor-link">3. MySQL分库分表的问题</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="h_1-mysql">1. 理解 MySQL 索引</h2>
<h3 id="h_1-1-mysql">1.1. MySQL 索引会常驻内存吗?</h3>
<p>会.   </p>
<h3 id="h_1-2-mysql">1.2. MySQL索引怎么被加载到内存的?</h3>
<p>在Linux中,innoDB 引擎中为<code>Innodb_buffer_pool</code>通过<code>mmap()</code>直接向操作系统申请内存,每次申请的大小为<code>innodb_buffer_pool_chunk_size</code>,最终会申请<code>innodb_buffer_pool_size</code>大小的文件映射段动态内存.以上初始化后,<code>Innodb_buffer_pool</code>缓存每次查询加载的目录页和数据页,直到<code>innodb_buffer_pool_size</code>大小的物理内存占用.直到在线减少<code>innodb_buffer_pool_size</code>或是关闭MySQL才会通过<code>munmap()</code>方式释放内存给操作系统.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>   </p>
<h3 id="h_1-3-mysql">1.3. 既然常驻内存,那MySQL索引如何被淘汰?</h3>
<p>无外乎还是那几个缓存淘汰算法。<code>Innodb_buffer_pool</code>的内存主要是通过 Free List、LRU List、FLU List、Unzip LRU List 等 4 个链表来进行管理分配。<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>   </p>
<ul>
<li>
<p>Free List：缓存空闲页   </p>
</li>
<li>
<p>LRU List：缓存数据页   </p>
</li>
<li>
<p>FLU List：缓存所有脏页   </p>
</li>
<li>
<p>Unzip LRU List：缓存所有解压页   </p>
</li>
</ul>
<h3 id="h_1-4-b">1.4. 为什么选择B+树?</h3>
<p>索引的本质在<strong>查询关键字</strong>与<strong>数据库记录</strong>之间建立的一种支持快速查找的数据结构 ，不一定是b+树，也可以是hash索引，也可以是b树/二叉树/数组/n叉树等等。 <br />
因为磁盘相比主存慢十万倍，而且磁盘一次能取一个扇区的数据<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>，因此索引的设计应当使每次磁盘<code>I/O</code>取到内存的数据都能帮助后续记录的定位，尽可能减少IO的次数。   </p>
<p>索引结构经历了<strong>Hash -&gt; 二叉树 -&gt; 平衡二叉树（BST） -&gt; 多路平衡二叉树（B-Tree） -&gt; B+树 -&gt; <code>B*</code>树</strong>的演变过程，依次提供了一些功能或解决了一些问题：   </p>
<ul>
<li>直接给每个记录唯一的键(hash值)，并通过唯一键给记录定位是最直接的想法   <ul>
<li>不同索引键可能存在相同 Hash 值而碰撞，且不支持Key比较，且不支持范围遍历   </li>
</ul>
</li>
<li>支持范围查找O(log2n)   <ul>
<li>树结点因为包括&lt;指针，主键，(记录)）&gt;所需空间变大   </li>
</ul>
</li>
<li>分叉少容易树高则查找次数变多   </li>
<li>支持n叉，尽可能在3次IO内定位记录，充分利用每次磁盘I/O取到内存的索引(每一次取的数据包含下一次的索引)   </li>
<li>受限于每一个数据<strong>页</strong>（结点）的存储空间<code>16k</code>(InnoDB),分开存储各级索引与记录以便每层存储更多索引，降低树深   </li>
<li>结点必要时换父亲，尽可能减少页分裂的次数   </li>
</ul>
<p>红黑树虽然也是B-Tree类型的树，但不会控制树的高度，所以不适合利用磁盘存储的MySQL 的。而因为B-Tree每一块的大小是固定的，如果有新的元素处于一个满了数据块的范围内，则会触发该数据块分裂,最糟糕时情况是一次插入操作所有的数据块都分裂了一遍，则带来的问题就是存储浪费，所以它不适合内存。 <br />
所以综合各方面考虑，MySQL 在当时的历史节点最后选择了 B+树。   </p>
<h3 id="h_1-5-b-treelog-structured-merge-tree">1.5. B-tree和Log-Structured Merge Tree本质区别是什么？</h3>
<p>LSM-tree将数据分为可变大小的顺序段，仅追加文件；B-tree则将数据分到固定大小（通常 4kb）的页中，并一个主键对应一个数据，在本页更新数据。   </p>
<h3 id="h_1-6-b">1.6. B+树和倒排索引本质区别是什么?</h3>
<p>注意倒排索引也是LSM的一种，所以它们的本质区别其实就是B树与LSM树的区别。不过在细节地方，它们也是各不相同： <br />
同样的一张表   </p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>address</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>lele</td>
<td>20</td>
<td>中国浙江杭州</td>
</tr>
<tr>
<td>2</td>
<td>youyou</td>
<td>21</td>
<td>中国江苏连云港</td>
</tr>
<tr>
<td>3</td>
<td>papa</td>
<td>18</td>
<td>中国安徽芜湖</td>
</tr>
<tr>
<td>4</td>
<td>anan</td>
<td>20</td>
<td>中国浙江宁波</td>
</tr>
<tr>
<td>5</td>
<td>nunu</td>
<td>20</td>
<td>美国加州</td>
</tr>
</tbody>
</table>
<h4 id="h_1-6-1-idb">1.6.1. 以id列为主键的B+树的聚簇索引</h4>
<p>为方便说明，假设目录页不受限制，数据页只能存储两条用户数据。 <br />
<img alt="" src="https://gitee.com/istarwyh/images/raw/master/vnote/程序员练级之路/技术/database/关系型数据库/mysql快问快答.md/514964595899450.png =1000x" />   </p>
<h4 id="h_1-6-2-address">1.6.2. 以address列为索引的二级索引</h4>
<p>假设该二级索引 中address 列按字典序排列。二级索引包含了索引列以及指向主键的指针。   </p>
<p><img alt="" src="https://gitee.com/istarwyh/images/raw/master/vnote/程序员练级之路/技术/database/关系型数据库/mysql快问快答.md/410113724586092.png =1000x" />   </p>
<h4 id="h_1-6-3-address">1.6.3. 为address列建立的倒排索引</h4>
<ul>
<li>Term Distionary:{"中国","浙江","杭州","宁波","江苏","连云港","美国","芜湖","加州"}   </li>
<li>Term Index: 通过FST 返回<code>Term Distionary</code>对应的地址   </li>
</ul>
<div class="lang-mermaid">

<div class="mermaid">
graph LR
c1((Root))
c1 --> z((中))
z --> g((国))
g --> zj((浙江))
zj --> h((杭))
h --> zhou((州))
c1 --> m((美))
m --> g
g --> jz((加))
jz --> zhou


</div>

</div>

<p>以中国浙江杭州“和“美国加州”两个Term 集合为例构成的FST，查询时”走到“中国”会返回<code>[1,2,3,4]</code>,走到“中国浙江”会返回<code>[1,4]</code>，走完路径“中国浙江杭州”会返回<code>[1]</code>。   </p>
<ul>
<li>Posting List: 通过倒排链返回对应的document的主键值   </li>
</ul>
<table>
<thead>
<tr>
<th>term</th>
<th>posting list</th>
</tr>
</thead>
<tbody>
<tr>
<td>中国</td>
<td>[1, 2, 3, 4]</td>
</tr>
<tr>
<td>浙江</td>
<td>[1, 4]</td>
</tr>
<tr>
<td>杭州</td>
<td>[1]</td>
</tr>
<tr>
<td>宁波</td>
<td>[4]</td>
</tr>
<tr>
<td>江苏</td>
<td>[2]</td>
</tr>
<tr>
<td>连云港</td>
<td>[2]</td>
</tr>
<tr>
<td>美国</td>
<td>[5]</td>
</tr>
<tr>
<td>加州</td>
<td>[5]</td>
</tr>
</tbody>
</table>
<h3 id="h_1-7-b">1.7. B+树的分叉数是多少?</h3>
<p>B+树的每个结点都是一个<code>16k</code>大小的页,目录页/索引页和数据页都是如此.目录页和数据页的数据结构也一样,通常包括File Header等占用的空间有1k,剩下的15k用于存索引键和页号.页号是固定的4byte大小, <br />
1. 假设<strong>索引键是<code>Bigint</code>(8byte)</strong>   </p>
<p>那么索引页中的一条仅含索引键的数据也就是 <br />
<center>4byte + 8byte = 12byte</center> <br />
假设分叉数为N,则 <br />
<center>N = 15*1024b/12b = 1280</center>   </p>
<p><span id='1.5'></span>   </p>
<h3 id="h_1-8-b-16kb">1.8. 为什么B+树的每个结点都是16kb大小?</h3>
<p>首先这个大小是怎么来的？因为innodb_buffer_pool 中默认page size 就是16kb。而这个16kb是在更少的磁盘IO、更快的查询速度和向操作系统申请更多的完整page_size大小内存之间的trade off。 <br />
第二为什么要使用固定大小的page_size？这个要和存储空间分配的细节联系起来看了。固定大小的页可以   </p>
<ul>
<li>减少数据对齐的带来的B+树结点修改、锁的开销   </li>
<li>减少磁盘的碎片化   </li>
<li>减少缓存的碎片化   </li>
</ul>
<h3 id="h_1-9-file-sysytem4kb">1.9. 可是File Sysytem的页大小是4kb啊？</h3>
<p>是的，File System的页固定为4kb已经是历史原因了。这带来的后果就是目前MySQL没有办法一次性写入磁盘，如果什么都不做，内存缓存区的页要分4次才能写入磁盘。写4次的过程中就可能因为硬件故障或者断电丢失数据。所以MySQL采用了<code>Double Write Buffer</code>的办法，即在硬盘上又开了一个2M的文件缓冲区，内存缓冲区的数据在写入真正的数据文件之前，先写入这个2M的文件缓冲区。   </p>
<h3 id="h_1-10-b">1.10. B+树一页能存多少数据?</h3>
<p>毫无疑问这取决于页中每行数据的大小. <br />
1. 假设<strong>一行数据1K</strong>   </p>
<p>那么除去File Header等的空间,还有15k,所以能存15条数据.   </p>
<h3 id="h_1-11-b">1.11. B+树为什么控制层高?一般控制为多少？</h3>
<p>首先层级越高,第一次取到目标页的磁盘IO次数就越多. <br />
另一方面,因为层级越高,目标页对应的目录页占用的空间也越大.当内存不足时,部分索引将被淘汰出缓存, 这样下次再访问这些索引结点还需要磁盘IO.因此为了提高性能,用尽可能少的磁盘IO获取页,必须控制层高. <br />
当 <br />
1. 只有一棵B+树 <br />
2. B+树的层级是3 <br />
3. 这颗树是一个完全N叉树 <br />
4. 该B+树的每个结点都是<code>16k</code>大小的页   </p>
<p>则该B+树的大小就是 <br />
<span class="arithmatex">\(16 k + 1280*16k + 1280*1280*16k \approx 2600w KB = 25 GB\)</span> <br />
其中，   </p>
<ul>
<li>16k: 第一个目录页结点的大小，也是第一层的结点大小   </li>
<li>1280: <a href="#h_1-7-b" class="anchor-link" class="anchor-link">1.7. B+树的分叉数是多少?</a> 推导出B+树分叉数为1280   </li>
</ul>
<p>可以看到此时一颗3层的完全B+树索引需要25GB的存储空间。   </p>
<h3 id="h_1-12-mysql2000w">1.12. 为什么都说Mysql单表不要超过2000w条数据?</h3>
<p>假如是3层的满B+树，有多少条数据呢？按照前述的假设可以得到   </p>
<p><span class="arithmatex">\(1280*1280*15 \approx 2.45kw\)</span>   </p>
<p>即一颗三层的满B+树大约2400万的数据量。 <br />
如果超过这个量级，一方面是初次查询一条数据则可能需要4次IO，绝对会变慢；另一方面是内存需要加载的索引会更多，从而更容易频繁汰换内存索引，以及未命中索引的查询更多都会导致此时单表的查询性能大幅下降。 <br />
所以会有MySQL单表不要超过2000w条数据的说法。 <br />
那是不是MySQL申请的内存足够大，即使超过2000w条也没有关系？理论上是的，但是上面说的只是一颗B+树的索引，MySQL的缓存要存储更多的B+树、写数据的缓存、临时表、辅助buffer等。 MySQl8.0默认的buffer pool为128MB<sup id="fnref3:1"><a class="footnote-ref" href="#fn:1">1</a></sup>。   </p>
<h3 id="h_1-13">1.13. 以上算了一遍，然后呢？</h3>
<p>上面的讨论有两个很重要的假设：   </p>
<ol>
<li>假设<strong>索引键是<code>Bigint</code>(8byte)</strong>   </li>
<li>假设<strong>一行数据1K</strong>   </li>
</ol>
<p>所以最后我们推算出Mysql单表不要超过2400w条数据，但实际上索引键的大小和一行数据的大小都不止上面的大小，所以实际中Mysql单表建议的数据量更小，且随着索引键以及一行数据的大小越大越小。 <br />
所以我们设计Mysql 表时要注意主键的选择和必要的垂直拆分。   </p>
<h2 id="h_2-sql">2.索引优化与慢SQL预防</h2>
<h3 id="h__1">如何建立主键索引?</h3>
<p>一个列可以选择多种数据类型时,数字类型-&gt;日期/二进制类型-&gt;字符类型,并且选择占用空间小的类型.   </p>
<h4 id="h__2">区分业务主键与数据库主键</h4>
<p>业务主键用于标识业务数据,进行表与表之间的关联。 Innodb要求每个表中都要有主键,按照<strong>主键的顺序</strong>逻辑存储.如果没有主键,会选择非空列的唯一索引.如果还没有,Innodb会生成6Byte的隐含主键. <br />
最好主键可以顺序增长,避免数据的逻辑迁移,减少IO;同时主键的字段类型应该尽可能的小,使一页中存储的主键数量更多   </p>
<h4 id="trade_no">索引可以用已有的唯一键，如trade_no吗？</h4>
<p>首先，普通索引不一定要求键要唯一；而如果建唯一索引或者主键索引，则应当自己建顺序主键。因为   </p>
<ul>
<li>trade_no具有自己的业务意义，不一定永远保证唯一性（比如对接了不同的trade_no合并到一张表）   </li>
<li>trade_no较长，主键使用空间多，二级索引空间也多   </li>
<li>trade_no一般为了安全会有一定随机性，这会使得建B*树时，不能顺序插入而被动随机插入，最后造成数据不够紧凑   </li>
</ul>
<h3 id="sql">慢SQL 预防与排查</h3>
<p><a href="/program/database/Prevention%20and%20Monitoring%20of%20Slow%20SQL.html">Prevention and Monitoring of Slow SQL</a>   </p>
<h3 id="h__3">如何优化索引</h3>
<h4 id="h__4">索引是最左匹配的</h4>
<ul>
<li>优化条件的从左到右的匹配顺序，以便利用索引   </li>
<li>如果还不行，使用<code>FORCE INDEX</code>优化已有索引   </li>
</ul>
<div class="lang-sql">

<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="k">database</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="k">table</span><span class="o">`</span><span class="w"> </span><span class="k">FORCE</span><span class="w"> </span><span class="k">INDEX</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">create_time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1508360400</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">create_time</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1508444806</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">create_time</span><span class="w"> </span><span class="k">asc</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
</code></pre></div>


</div>

<ul>
<li>添加唯一索引   </li>
<li>添加组合索引(必要的组合索引，或者利用覆盖索引)   </li>
</ul>
<h4 id="h__5">默认的索引下推优化</h4>
<div class="lang-sql">

<div class="codehilite"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">itemName</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="err">“前缀”</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">itemSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span>
</code></pre></div>


</div>

<p>假如itemName是索引，那么MySQL5.6之后优化为在索引遍历过程中，对索引中包含的itemSize先做判断，直接过滤掉不满足条件的记录--&gt;减少回表次数<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup>。   </p>
<h4 id="h__6">隐藏索引</h4>
<p>Mysql8中引入隐藏索引,这种索引不会被优化器所使用,从而可以利用它来快速测试删除索引后对SQL查询性能的影响,如果有用则设置可见即可,而避免索引删除与重建耗费时间.   </p>
<h2 id="h_3-mysql">3. MySQL分库分表的问题</h2>
<p><a href="/program/database/relational_database/Possible%20Problems%20with%20Sharding%20and%20Partitioning.html">Possible Problems with Sharding and Partitioning</a>   </p>
<script>
                    function initializeMermaid() {
                        mermaid.initialize({startOnLoad:true})
                    }

                    if (document.readyState === "complete" || document.readyState === "interactive") {
                        setTimeout(initializeMermaid, 1);
                    } else {
                        document.addEventListener("DOMContentLoaded", initializeMermaid);
                    }
            </script>

<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://cloud.tencent.com/developer/article/1800973" class="external-link">MySQL8.0之内存消耗关键因素</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 0 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 0 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:1" title="Jump back to footnote 0 in the text">&#8617;</a></p>
</li>
<li id="fn:2"></li>
<li id="fn:3">
<p><a href="https://juejin.cn/post/6844904201437315079" class="external-link">「数据库调优」屡试不爽的面试连环combo</a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p><a href="https://blog.csdn.net/gprime/article/details/1687930" class="external-link">如何让你的SQL运行得更快</a>&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div></div>
<div class="note-footer">
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
	<li><a class="backlink" href="/program/database/relational_database/Possible Problems with Sharding and Partitioning.html">possible problems with sharding and partitioning</a></li>
	<li><a class="backlink" href="/index.html">index</a></li>
</ul>
</div>

<div class="tags">

</div>

</div>
<div class="graph requires_js ">
    <div id="A48109223982887964552010099724762680572{level}" class="graph_div"></div>

    <div class="graph-instructions" id="D48109223982887964552010099724762680572{level}">
        Left-click: follow link, Right-click: select node, Scroll: zoom
    </div>
    
    <div class="graph-button-row" style="display:flex;">
        <button class="graph_button graph_show_button" id="B48109223982887964552010099724762680572{level}" level="{level}" note_temp_id="48109223982887964552010099724762680572" onclick="window.ObsHtmlGraph.run(this, '48109223982887964552010099724762680572', 'mysql faq');">
            Show Graph
        </button>
        <button class="graph_button graph_type_button" id="C48109223982887964552010099724762680572{level}" style="flex:1" onclick="window.ObsHtmlGraph.switch_graph_type(this);">
            2D
        </button>
    </div>
</div>

<script type="module">
    if (window.ObsHtmlGraph == undefined){
        import('/obs.html/static/graph.js').then((Module) => {
            window.ObsHtmlGraph = Module;
            window.ObsHtmlGraph.arm_page(document.getElementById('page_holder'))
        })
    }
</script>




                                <!-- end content -->
                        </div>
                        <div class="container_filler">
                        </div>
                        <div id="right_pane" class="right_pane active">
    <div id="right_pane_fold_header" class="right_pane_fold_header fold_header">x</div>
    <div id="right_pane_content" class="right_pane_content">
            
    </div>
</div>
                </div>
        </div>

        <script>
                function handle_toggle_side_bar(e){
                        let header;
                        let pane; 
                        let target = e.target

                        // switch out the navbar button click for a header click
                        if (target.id == 'left_pane_toggle_nav'){
                                target = document.getElementById('left_pane_fold_header')
                        }
                        else if (target.id == 'right_pane_toggle_nav'){
                                target = document.getElementById('right_pane_fold_header')
                        }

                        // get header and pane
                        if (target.classList.contains('fold_header')) {
                                header = target;
                                pane = target.parentElement;
                        }
                        else {
                                pane = target;
                                header = target.getElementsByClassName('fold_header')[0];
                        }
                        toggle_side_bar(pane, header, true)
                        e.stopPropagation();
                }
                function handle_toggle_side_bar_button(e){
                        document.getElementById('menu_toggle_button').click()
                        handle_toggle_side_bar(e);
                }

                function toggle_side_bar(pane, header, save) {
                        let active = (pane.classList.contains('active'))
                        if (active){
                                disable_side_bar(pane, header, save);
                        }
                        else {
                                enable_side_bar(pane, header, save);
                        }
                }
                function enable_side_bar(pane, header, save){
                        pane.classList.add('active');
                        pane.removeEventListener('click', handle_toggle_side_bar);
                        header.addEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, true) }
                }
                function disable_side_bar(pane, header, save){
                        pane.classList.remove('active');
                        pane.addEventListener('click', handle_toggle_side_bar);
                        header.removeEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, false) }
                }
                function set_correct_header_symbol(header){
                        let pane = header.parentElement;
                        let symbol = [['>', '<'],['<', '>']]
                        symbol = symbol[Number(header.classList.contains('right_pane_fold_header'))][Number(pane.classList.contains('active'))];
                        console.log(symbol);
                        header.innerHTML = symbol
                        return header;
                }
                function panel_folding_get_panel_name(header){
                        return ['left', 'right'][Number(header.classList.contains('right_pane_fold_header'))]
                }
                function save_panel_folding_state(header, active){
                        ls_set('pane_folding_state_'+panel_folding_get_panel_name(header), Number(active));
                }
                function load_panel_folding_state(panel_name){
                        val = ls_get('pane_folding_state_'+panel_name)
                        if (!val){ return {'exists': false, 'value': null}}
                        return {'exists': true, 'value': Boolean(Number(val))}
                }
                function set_pane_folding_start(left_header, right_header){
                        // small screen = closed
                        let right_pane_enabled = true;
                        let left_pane_enabled = true;
                        let w = window.visualViewport.width
                        if (w < 1000){
                                left_pane_enabled = false
                        }
                        if (w < 800){
                                right_pane_enabled = false
                        }

                        // get saved values if present
                        let rval = load_panel_folding_state('right')
                        if (rval['exists']){
                                right_pane_enabled = rval['value']
                        }
                        let lval = load_panel_folding_state('left')
                        if (lval['exists']){
                                left_pane_enabled = lval['value']
                        }

                        // default = enabled, so we only need to disable
                        if (!left_pane_enabled){
                                disable_side_bar(document.getElementById('left_pane'), document.getElementById('left_pane_fold_header'))
                        }
                        if (!right_pane_enabled){
                                disable_side_bar(document.getElementById('right_pane'), document.getElementById('right_pane_fold_header'))
                        }
                }

                function init_pane_folding(header){
                        set_correct_header_symbol(header);
                        header.addEventListener('click', handle_toggle_side_bar);
                }
                
                
                set_pane_folding_start()
                init_pane_folding(document.getElementById('left_pane_fold_header'));
                init_pane_folding(document.getElementById('right_pane_fold_header'));

                document.getElementById('left_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
                document.getElementById('right_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
        </script>

        <script src="/obs.html/static/load_dirtree_footer.js" type="text/javascript"></script>

        




</body>
</html>
