## 1. 基于LSP的专业英语写作辅助客户端与服务器端设计与开发
## 2. 写作背景
![](https://gitee.com/istarwyh/images/raw/master/1604577980_20201105182359284_30406.png)
### 2.1. 需求
#### 2.1.1. 词伙补全（词伙，释义，图片）
- 固定句式
**By the time** Doug Raysby's wife was allowed to enter his hospital room, **it was too late to** be sure whether he even knew she was there.

zero-sum game
#### 2.1.2. 字数提示
#### 2.1.3. 时间提示（图表题/议论文等）
#### 2.1.4. （拼写纠错/非常规表达提示）静态检查
#### 2.1.5. 学术写作规则约束
#### 2.1.6. 英语语言格式化
#### 2.1.7. 提供雅思真题仿写（填鸭式）
#### 2.1.8. 优化交互体验
##### 2.1.8.1. 补全允许取消
![](https://gitee.com/istarwyh/images/raw/master/1608472069_20201220214552969_961.png)
### 2.2. 可能的需求
- 添加.english语言的定义
- 添加欢迎页面
- 划词翻译：主要用于写了不确定单词后的场景。主要是通过剪贴板调用翻译API实现。https://mp.weixin.qq.com/s/hB5u-jF5tvwtIeSXa2l4hg

## 3. 竞品调研
### 3.1. Hallelujah输入法
hallelujah是我永远不会记住如何拼写的单词之一，但我知道它以“ halle”开头。--[hallelujah_autocompletion](https://daringfireball.net/2006/10/hallelujah_autocompletion)
### 3.2. 英语作文修改润色
以雅思官方8分范文为例，
Life skills are very important and by doing voluntary work, students learn not only how to communicate with others but also how to manage their time and improve their organisational skills. Unfortunately, teenagers today do not have many after-school activities. After-school clubs are no longer popular and students mostly go home and sit in front of the TV, browse the Internet or play video games.
#### 3.2.1. Grammar
也有office插件，并且会在office里嵌入检查。
![](https://gitee.com/istarwyh/images/raw/master/1605280337_20201113231209720_9568.png)
#### 3.2.2. 改写匠

改写匠的批改结果并不好，所给的三个意见有两个是错的。
![](https://gitee.com/istarwyh/images/raw/master/1604577986_20201105200603069_8904.png)
#### 3.2.3. AI辅助写作
#### 3.2.4. 搜狗翻译
搜狗翻译App的“作文批改”功能，AI写作助手便可针对用户输入的作文内容，指出写作中基础的语法或拼写等错误，提供8种经AI算法优化后的语句润色升级方式。用户还能利用批改前后对照功能，通过“输入-反馈-修正-对比”的良性循环方式，科学、高效的提升写作能力。
### 3.3. 其他
#### 3.3.1. 益加医
https://zhuanlan.zhihu.com/p/139657826
![](https://gitee.com/istarwyh/images/raw/master/1604577984_20201105183335470_27875.png)


### 3.4. Step
把ts服务器与客户端改造成java写的
凑文献


## 4. 未知的
### 4.1. 问题
1. 为什么微软不能用http协议,而自己搞一套协议?
2. 服务器端和客户端一起打包发布的是什么?
3. 服务器端是自动挂载到微软的后台服务器上运行的吗?
### 4.2. 其他
#### 4.2.1. 读取pdf
elctron+pdf.js+云函数
React Native 做订阅
#### 4.2.2. 异步调用
```ts
function lazyHookCreation() {
  const inspector = internalBinding('inspector');
  const { createHook } = require('async_hooks');
  config = internalBinding('config');

  hook = createHook({
    init(asyncId, type, triggerAsyncId, resource) {
    // It's difficult to tell which tasks will be recurring and which won't,
    // therefore we mark all tasks as recurring. Based on the discussion
    // in https://github.com/nodejs/node/pull/13870#discussion_r124515293,
    // this should be fine as long as we call asyncTaskCanceled() too.
      const recurring = true;
      if (type === 'PROMISE')
        this.promiseIds.add(asyncId);
      else
        inspector.asyncTaskScheduled(type, asyncId, recurring);
    },

    before(asyncId) {
      if (this.promiseIds.has(asyncId))
        return;
      inspector.asyncTaskStarted(asyncId);
    },

    after(asyncId) {
      if (this.promiseIds.has(asyncId))
        return;
      inspector.asyncTaskFinished(asyncId);
    },

    destroy(asyncId) {
      if (this.promiseIds.has(asyncId))
        return this.promiseIds.delete(asyncId);
      inspector.asyncTaskCanceled(asyncId);
    },
  });

  hook.promiseIds = new Set();
}
```
为什么
```ts
 destroy(asyncId) {
      if (this.promiseIds.has(asyncId))
        return this.promiseIds.delete(asyncId);
      inspector.asyncTaskCanceled(asyncId);
    },
```
总是会调用下面的函数呢？
```typescript
// Called from native. The asyncId stack handling is taken care of there
// before this is called.
function emitHook(symbol, asyncId) {
  active_hooks.call_depth += 1;
  // Use a single try/catch for all hook to avoid setting up one per
  // iteration.
  try {
    for (var i = 0; i < active_hooks.array.length; i++) {
      if (typeof active_hooks.array[i][symbol] === 'function') {
        active_hooks.array[i][symbol](asyncId);
      }
    }
  } catch (e) {
    fatalError(e);
  } finally {
    active_hooks.call_depth -= 1;
  }

  // Hooks can only be restored if there have been no recursive hook calls.
  // Also the active hooks do not need to be restored if enable()/disable()
  // weren't called during hook execution, in which case
  // active_hooks.tmp_array will be null.
  if (active_hooks.call_depth === 0 && active_hooks.tmp_array !== null) {
    restoreActiveHooks();
  }
}
```
#### 4.2.3. 机器翻译
机器翻译与检索最开始是源于情报翻译的需求,它最开始被实现为一种机械的解读密码的方式,渐渐地人们认识到需要综合分析词法、句法和语义分析来实现,目前业界认为应该围绕英语文本写作打造词汇、语法、语义、内容与结构的全信息智能双语辅助学习工作系统.
#### 4.2.4. 备份
1.在线申请：登录学院综合信息服务平台实习与开题板块在线提交论文开题申请；
2.开题：联系导师，请导师组织开题报告会，要求至少两位专家（两位专家其中一位须是导师或协助导师，另一位为导师或协助导师指定的专家）参加开题；
3.在北大校内门户中录入开题报告内容
1)录入地址：北大主页—校内门户—登陆—业务办理—研究生院—培养环节录入及打印；
2)注意事项：培养环节录入及打印主要就是完成开题情况的录入工作 ，请录入开题时间（如有题目变化二次开题的也请录入第一次开题时间），本人陈述请输入开题报告，考评小组意见请录入开题评审表中记录部分内容，并要在最后明确录入“同意通过开题”。导师意见写“同意通过开题”， 考评小组成员姓名可不填写。（北大系统生成的开题表格无需打印提交。）
3)请使用火狐（FireFox）浏览器进行操作，其他浏览器可能无法正常提交。
4.纸质材料提交：登录学院综合信息服务平台实习与开题板块下载论文开题材料模板，打印并请参与开题的两位专家签字后（两位专家其中一位须是导师或协助导师，另一位为导师或协助导师指定的专家），提交至教务办公室1111门口的信箱。（特别提示：纸质材料须双面打印，如需装订请使用曲别针，不要使用订书钉。未按要求打印装订的材料将被视为无效，需重新提交。）


#### 4.2.5. 可能的问题
问题1: 为什么会想要做这个?
答：因为笔者在备考雅思过程中切实感到了当前英语辅导写作中存在的一些痛点。并在阅读论文深入剖析英语写作过程的过程中了解到确实针对词伙策略开发的软件或工具存在空白，加上实现一个语言服务器本身是很有想象力的事，于是我选择了这个题目而没有选择传统的网页开发。
问题2：那你觉得你能完成吗？
答：有一定把握。因为语言服务器的实现是很广泛的，我可以学习已有的优秀实践。正是因为有了语言服务器,一门特定的语言才可能实现在文本编辑器或IDE中的自动补全、定义跳转等功能。不过自然语言如英语与精通编译原理的大师们设计出来的程序语言有着天然的不同,前者是非结构化的非人为设计的语言,而后者可以按照编译原理对其生成抽象语法树或控制流图进行编译。我需要深入学习Java语言服务器Eclipse JDT Language Server等打造一个专门为英语文本写作开发的英语语言服务器。 
问题3: 那你为什么不采用批改网那种的网页形式？
答： 因为我本身没有社区运营或者盈利的需求，并且对写作者来说，无论是否备考，离线都是更好的，因此采用单一的文本编辑器作为客户端载体是更符合开发初衷的。并且考虑到跨平台和跨文本编辑器的需要，采用了微软提出的LSP这个json RPC协议，在VS Code上也可以使用它已有的包括Hover,Completion等服务API更好的打造这个英语辅助工具。
